!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["react","prop-types","react-router-dom"],n):e.PreloadLink=n(e.React,e.PropTypes,e.ReactRouterDOM)}(this,function(e,n,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var o=0,r=function(){},a=function(){return++o},i="onLoading",u="onSuccess",c="onFail",l="onNavigate",s="preloadLink/fail",p=(function(){function e(e){this.value=e}function n(n){var t,o;function r(t,o){try{var i=n[t](o),u=i.value;u instanceof e?Promise.resolve(u.value).then(function(e){r("next",e)},function(e){r("throw",e)}):a(i.done?"return":"normal",i.value)}catch(e){a("throw",e)}}function a(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?r(t.key,t.arg):o=null}this._invoke=function(e,n){return new Promise(function(a,i){var u={key:e,arg:n,resolve:a,reject:i,next:null};o?o=o.next=u:(t=o=u,r(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}),f=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},v=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},h=s,y=function(n){function o(){p(this,o);var e=v(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return e.setLoading=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=o.process,a=e.props.noInterrupt;!a&&t.busy&&t.uid!==e.uid?t.cancelUid=t.uid:a&&(t.canCancel=!1),o.process=d({},t,{uid:e.uid,busy:!0}),e.setState({loading:!0},n)},e.setLoaded=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;o.process.canCancel||(o.process.canCancel=!0),o.process=d({},o.process,{uid:0,busy:!1}),e.setState({loading:!1},n)},e.navigate=function(){var n=e.props,t=n.history,o=n.to,r=function(){return e.executeHook(l)};t.push(o),e.props[l]?e.props[l](r):r()},e.executeHook=function(e){var n=o[e];n&&("function"!=typeof n?console.error("PreloadLink: Method for lifecycle '"+e+"' is not a function."):n())},e.prepareHookCall=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,o=n===i?e.setLoading:e.setLoaded,a=function(){return e.executeHook(n)};e.props[n]?(e.props[n](a),o(t)):o(function(){a(),t()})},e.unwrapWithMiddleware=function(n){return n().then(function(n){e.props.loadMiddleware(n)})},e.prepareNavigation=function(){var n=o.process,t=e.props.load,r=Array.isArray(t),a=void 0;if(r){var i=t.map(function(n){return e.unwrapWithMiddleware(n)});a=Promise.all(i)}else a=e.unwrapWithMiddleware(t);a.then(function(t){n.cancelUid!==e.uid&&((r?t.includes(h):t===h)?e.prepareHookCall(c):e.prepareHookCall(u,e.navigate))}).catch(function(){e.prepareHookCall(c)})},e.handleClick=function(n){var t=o.process,r=e.props.onClick;n.preventDefault(),r(),t.busy&&!t.canCancel||(e.props.load?(e.prepareHookCall(i),e.state.loading||e.prepareNavigation()):e.navigate())},e.state={loading:!1},e.uid=a(),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(o,e.Component),f(o,[{key:"render",value:function(){var n=this.props,o=n.to,r=n.children,a=n.navLink,i=n.className,u=n.activeClassName,c=a?t.NavLink:t.Link,l={};return a&&(l.activeClassName=u),e.createElement(c,d({className:i,to:o,onClick:this.handleClick},l),r)}}]),o}();y.process={uid:0,busy:!1,cancelUid:0,canCancel:!0},y.init=function(e){y[i]=e[i],y[u]=e[u],y[c]=e[c],y[l]=e[l]},y.defaultProps={onLoading:null,onSuccess:null,onFail:null,onNavigate:null,noInterrupt:!1,loadMiddleware:r,navLink:!1,onClick:r};var k=y.init,b=t.withRouter(y);return b.PRELOAD_FAIL=s,b.configure=k,b});
