!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["react","prop-types","react-router-dom"],n):e.PreloadLink=n(e.React,e.PropTypes,e.ReactRouterDOM)}(this,function(e,n,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var r=0,o=function(){},i=function(){return++r},a="onLoading",u="onSuccess",c="onFail",s="onNavigate",l="preloadLink/fail",f=(function(){function e(e){this.value=e}function n(n){var t,r;function o(t,r){try{var a=n[t](r),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){o("next",e)},function(e){o("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?o(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise(function(i,a){var u={key:e,arg:n,resolve:i,reject:a,next:null};r?r=r.next=u:(t=r=u,o(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}),p=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},v=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},h=l,y=function(n){function r(){f(this,r);var e=v(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e.setLoading=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=r.process,i=e.props.noInterrupt;!i&&t.busy&&t.uid!==e.uid?t.cancelUid=t.uid:i&&(t.canCancel=!1),r.process=d({},t,{uid:e.uid,busy:!0}),e.setState({loading:!0},function(){return n()})},e.setLoaded=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;r.process.canCancel||(r.process.canCancel=!0),r.process=d({},r.process,{uid:0,busy:!1}),e.setState({loading:!1},function(){return n()})},e.update=function(n){var t=r[n],o=function(e){e&&("function"!=typeof e?console.error("PreloadLink: Method for lifecycle '"+n+"' is not a function."):e())};e.props[n]?(e.props[n](function(){return o(t)}),e.setLoading()):e.setLoading(function(){return o(t)})},e.navigate=function(){var n=e.props,t=n.history,o=n.to;t.push(o),r[s]&&r[s]()},e.handleFailed=function(){e.update(c),e.setLoaded()},e.returnsPromise=function(e){var n=e();return Promise.resolve(n)===n},e.prepareNavigation=function(){var n=r.process,t=e.props.load,o=Array.isArray(t),i=void 0;if(o){for(var a=[],c=0;c<t.length;c+=1){var s=t[c];if(!e.returnsPromise(s))return console.error("Error: Not all given functions are returning a Promise. Aborting navigation. "),e.handleFailed();a.push(s)}i=Promise.all(a)}else{if(!e.returnsPromise(t))return console.error("Error: Given load function does not return a Promise. Aborting navigation. "),e.handleFailed();i=t()}i.then(function(t){n.cancelUid!==e.uid&&((o?t.includes(h):t===h)?e.handleFailed():(e.update(u),e.setLoaded(function(){return e.navigate()})))}).catch(function(){e.handleFailed()})},e.handleClick=function(n){var t=r.process;n.preventDefault(),t.busy&&!t.canCancel||(e.props.load?(e.update(a),e.state.loading||e.setLoading(function(){return e.prepareNavigation()})):e.navigate())},e.state={loading:!1},e.uid=i(),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(r,e.Component),p(r,[{key:"render",value:function(){var n=this.props,r=n.to,o=n.children;return e.createElement(t.Link,{to:r,onClick:this.handleClick},o)}}]),r}();y.process={uid:0,busy:!1,cancelUid:0,canCancel:!0},y.init=function(e){y[a]=e.onLoading,y[u]=e.onSuccess,y[c]=e.onFail,y[s]=e.onNavigate},y.defaultProps={onLoading:null,onSuccess:null,onFail:null,noInterrupt:!1};var g=y.init,b=t.withRouter(y);return b.PRELOAD_FAIL=l,b.configure=g,b});
