!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("react"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["react","prop-types","react-router-dom"],n):e.PreloadLink=n(e.React,e.PropTypes,e.ReactRouterDOM)}(this,function(e,n,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var o=0,r=function(){},i=function(){return++o},a="onLoading",u="onSuccess",c="onFail",s="onNavigate",l="preloadLink/fail",f=(function(){function e(e){this.value=e}function n(n){var t,o;function r(t,o){try{var a=n[t](o),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?r(t.key,t.arg):o=null}this._invoke=function(e,n){return new Promise(function(i,a){var u={key:e,arg:n,resolve:i,reject:a,next:null};o?o=o.next=u:(t=o=u,r(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}),p=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),d=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},y=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},v=l,h=function(n){function o(){f(this,o);var e=y(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return e.setLoading=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=o.process,i=e.props.noInterrupt;!i&&t.busy&&t.uid!==e.uid?t.cancelUid=t.uid:i&&(t.canCancel=!1),o.process=d({},t,{uid:e.uid,busy:!0}),e.setState({loading:!0},function(){return n()})},e.setLoaded=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;o.process.canCancel||(o.process.canCancel=!0),o.process=d({},o.process,{uid:0,busy:!1}),e.setState({loading:!1},function(){return n()})},e.update=function(n){var t=o[n],r=function(e){e&&("function"!=typeof e?console.error("PreloadLink: Method for lifecycle '"+n+"' is not a function."):e())};e.props[n]?(e.props[n](function(){return r(t)}),e.setLoading()):e.setLoading(function(){return r(t)})},e.navigate=function(){var n=e.props,t=n.history,r=n.to;t.push(r),o[s]&&o[s]()},e.prepareNavigation=function(){var n=o.process,t=e.props.load,r=Array.isArray(t),i=void 0;if(r){var a=t.map(function(e){return e()});i=Promise.all(a)}else i=t();i.then(function(t){n.cancelUid!==e.uid&&((r?t.includes(v):t===v)?(e.update(c),e.setLoaded()):(e.update(u),e.setLoaded(function(){return e.navigate()})))}).catch(function(){e.update(c),e.setLoaded()})},e.handleClick=function(n){var t=o.process;n.preventDefault(),t.busy&&!t.canCancel||(e.props.load?(e.update(a),e.state.loading||e.setLoading(function(){return e.prepareNavigation()})):e.navigate())},e.state={loading:!1},e.uid=i(),e}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(o,e.Component),p(o,[{key:"render",value:function(){var n=this.props,o=n.to,r=n.children;return e.createElement(t.Link,{to:o,onClick:this.handleClick},r)}}]),o}();h.process={uid:0,busy:!1,cancelUid:0,canCancel:!0},h.init=function(e){h[a]=e.onLoading,h[u]=e.onSuccess,h[c]=e.onFail,h[s]=e.onNavigate},h.defaultProps={onLoading:null,onSuccess:null,onFail:null,noInterrupt:!1};var b=h.init,g=t.withRouter(h);return g.PRELOAD_FAIL=l,g.configure=b,g});
